<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mini Video Editor</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<header id="topBar">
  <div class="title">Mini Video Editor</div>
  <div class="imports">
    <label class="btn sm">Video
      <input type="file" id="inputVideo" accept="video/*" hidden multiple>
    </label>
    <label class="btn sm">Audio
      <input type="file" id="inputAudio" accept="audio/*" hidden multiple>
    </label>
    <label class="btn sm">Image
      <input type="file" id="inputImage" accept="image/*" hidden multiple>
    </label>
    <button class="btn sm" id="addTextBtn">Text</button>
    <button class="btn sm" id="duplicateBtn" title="Duplicate Selected (Ctrl+D)">Duplicate</button>
    <button class="btn sm" id="splitBtn" title="Split at Playhead (C)">Split</button>
    <button class="btn sm" id="deleteBtn" title="Delete Selection (Del)">Delete</button>
    <button class="btn sm" id="rippleBtn" title="Toggle Ripple Delete">Ripple: Off</button>
    <button class="btn sm" id="recordVoiceBtn" title="Record Voice Over (V)">Record VO</button>
    <button class="btn sm" id="autoFitBtn" title="Fit entire timeline width">AutoFit</button>
    <button class="btn sm accent" id="renderBtn">Render</button>
    <button class="btn sm" id="exportBtn">Export JSON</button>

  </div>
  <div class="history">
    <button class="btn sm" id="undoBtn" title="Undo (Ctrl+Z)">Undo</button>
    <button class="btn sm" id="redoBtn" title="Redo (Ctrl+Y)">Redo</button>
  </div>
</header>

<main id="workspace">
  <aside id="leftPanel">
    <div class="panel-header">LAYERS (Top = Front)</div>
    <ul id="layersList"></ul>
  </aside>

  <section id="centerPanel">
    <div id="previewShell">
      <div id="previewStage">
        <video id="videoMain" playsinline></video>
        <div id="overlayStage"></div>
      </div>
    </div>
    <div id="playbackControls">
      <div class="group">
        <button class="btn sm" id="playPauseBtn" title="Space">Play</button>
        <button class="btn sm" id="replayBtn" title="Replay (Shift+R)">Replay</button>
        <button class="btn sm" id="frameBackBtn" title="Prev Frame (←)">◀︎</button>
        <button class="btn sm" id="frameFwdBtn" title="Next Frame (→)">▶︎</button>
        <button class="btn sm" id="markInBtn" title="I">[ In</button>
        <button class="btn sm" id="markOutBtn" title="O">Out ]</button>
        <button class="btn sm" id="loopBtn" title="Loop (L)">Loop: Off</button>
      </div>
      <div id="timeReadout">
        <span>Cur</span><b id="tcCurrent">00:00:00.000</b>
        <span>Dur</span><b id="tcDuration">00:00:00.000</b>
        <span>In</span><b id="tcIn">--:--:--.--</b>
        <span>Out</span><b id="tcOut">--:--:--.--</b>
      </div>
      <div class="group">
        <label class="zoom-label">Zoom
          <input type="range" id="timelineZoom" min="20" max="400" value="60">
        </label>
        <span id="importStatus" class="import-status"></span>
      </div>
      <div id="voStatus" class="vo-status hidden">
        <span id="voState">Idle</span>
        <div class="meter" title="Input level">
          <div class="meter-level" id="voLevel"></div>
        </div>
        <button class="btn xs hidden" id="cancelVoBtn" title="Discard this recording">Discard</button>
      </div>
    </div>
  </section>

  <aside id="rightPanel">
    <div class="panel-header">INSPECTOR</div>
    <div id="inspector">
      <p class="placeholder">Select a clip / overlay / audio</p>

      <section id="videoClipSection" class="hidden">
        <h4>Video Clip</h4>
        <label>Start (timeline) <input type="number" step="0.001" id="clipStart"></label>
        <label>Source In <input type="number" step="0.001" id="clipIn"></label>
        <label>Source Out <input type="number" step="0.001" id="clipOut"></label>
        <div class="trim-row">
          <button class="btn xs" id="btnClipInSet" title="Set source In to playhead">Clip In ←</button>
          <button class="btn xs" id="btnClipOutSet" title="Set source Out to playhead">Clip Out →</button>
          <button class="btn xs" id="btnFitToRange" title="Fit clip to global In–Out">Fit Range</button>
        </div>
      </section>

      <section id="overlaySection" class="hidden">
        <h4>Overlay</h4>
        <label>Start <input type="number" step="0.001" id="ovStart"></label>
        <label>End <input type="number" step="0.001" id="ovEnd"></label>
        <label>X <input type="number" id="ovX"></label>
        <label>Y <input type="number" id="ovY"></label>
        <label>Scale <input type="number" step="0.01" id="ovScale"></label>
        <label>Opacity <input type="range" min="0" max="1" step="0.01" id="ovOpacity"></label>
        <div id="textFields" class="hidden">
          <label>Text <textarea id="ovText"></textarea></label>
          <label>Font Size <input type="number" id="ovFontSize"></label>
          <label>Color <input type="color" id="ovColor"></label>
        </div>
      </section>

      <section id="audioSection" class="hidden">
        <h4>Audio Clip</h4>
        <label>Offset <input type="number" step="0.001" id="audOffset"></label>
        <label>Volume <input type="range" min="0" max="1" step="0.01" id="audVolume"></label>
        <label><input type="checkbox" id="audMute"> Mute</label>
      </section>

      <button class="btn sm accent hidden" id="applyBtn">Apply</button>
    </div>
    <!-- Query Section (Non-invasive addition) -->
    <!-- Place this inside #rightPanel, preferably after the existing #inspector block -->
    <section id="querySection" class="query-section">
      <h4 id="queryTitle">Query</h4>
      <label for="queryInput" class="query-label">Enter topic</label>
      <div class="query-row">
        <input
          id="queryInput"
          type="text"
          placeholder="Type a topic (e.g., Pythagoras theorem)"
          aria-label="Query topic"
        />
        <button
          id="querySubmit"
          class="btn sm accent"
          type="button"
          title="Submit query"
        >
          Submit
        </button>
      </div>
      <!-- Response will be rendered here -->
      <div id="queryOutput" class="query-output" role="status" aria-live="polite"></div>
    </section>
  </aside>
</main>

<footer id="timelineArea">
  <div id="rulerScroller">
    <div id="timeRuler"></div>
    <div id="playhead"></div>
    <div id="inMarker" class="marker in hidden"></div>
    <div id="outMarker" class="marker out hidden"></div>
    <div id="rangeFill" class="range-fill hidden"></div>
  </div>
  <div id="tracksScroller">
    <div class="track video-track" id="videoTrack">
      <div class="track-label">V1</div>
      <div class="track-content" id="videoTrackContent"></div>
    </div>
    <div class="track overlay-track" id="overlayTrack">
      <div class="track-label">OV</div>
      <div class="track-content" id="overlayTrackContent"></div>
    </div>
    <div class="track audio-track" id="audioTrack">
      <div class="track-label">A1</div>
      <div class="track-content" id="audioTrackContent"></div>
    </div>
  </div>
</footer>

<div id="renderModal" class="modal hidden">
  <div class="modal-content">
    <h3>Render Video</h3>
    <label>Range
      <select id="renderRange">
        <option value="all">Entire</option>
        <option value="range">In-Out</option>
      </select>
    </label>
    <label>Resolution
      <select id="renderRes">
        <option value="1280x720" selected>1280x720</option>
        <option value="640x360">640x360</option>
      </select>
    </label>
    <label>FPS
      <select id="renderFPS">
        <option>30</option><option>24</option><option>25</option><option>60</option>
      </select>
    </label>
    <label><input type="checkbox" id="renderAudio" checked> Include Audio</label>
    <label><input type="checkbox" id="renderOverlays" checked> Include Overlays</label>
    <div id="renderProgress" class="hidden">
      <div class="progress-bar"><div class="progress-fill" id="renderFill"></div></div>
      <div class="progress-info">
        <span id="renderPct">0%</span>
        <span id="renderElapsed">0.0s</span>
      </div>
    </div>
    <div class="render-buttons">
      <button class="btn sm accent" id="startRenderBtn">Start</button>
      <button class="btn sm danger hidden" id="cancelRenderBtn">Cancel</button>
      <button class="btn sm hidden" id="downloadRenderBtn">Download Again</button>
      <button class="btn sm" id="closeRenderBtn">Close</button>
    </div>
    <p id="renderStatus" class="status"></p>
  </div>
</div>

<canvas id="hiddenCanvas" width="320" height="180" class="hidden"></canvas>
<canvas id="renderCanvas" class="hidden"></canvas>

<script src="app.js"></script>
</body>
</html>